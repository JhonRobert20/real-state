{% extends 'base.html' %}

{% block title %}Real State{% endblock %}
{% block content %}

{% load crispy_forms_tags %}

<div class="container py-5">
	{% if user.is_authenticated %}
	<p class="text-center">Real State Chat Api</p>
	<form id="new-chat-form" method="POST" action="{% url 'new_chat' %}">
		{% csrf_token %}
		<button type="submit" class="btn btn-primary">New chat</button>
	</form>

	<script>
		document.getElementById("new-chat-form").addEventListener("submit", function(event) {
			event.preventDefault()
			let xhr = new XMLHttpRequest();
			xhr.open("POST", "{% url 'new_chat' %}");
			xhr.setRequestHeader("Content-Type", "application/json");
			xhr.setRequestHeader("X-CSRFToken", "{{ csrf_token }}");
			xhr.onload = function() {
				window.location.href = xhr.getResponseHeader("Location");
			};
			xhr.send();
		});
    </script>

	{% else %}
		<h1 class="text-center"> This information is only for registered users</h1>
	{% endif %}
</div>

{% endblock %}
